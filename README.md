## AWS の設定方法

### 1.IAM ユーザーの作成

IAM は AWS リソースへのアクセスをセキュアに制御するサービス。AWS リソースを使用するユーザーやアプリケーションに対して適切なアクセス権限を付与することができる。

#### 1.ユーザーの詳細を指定

- チェックボックス
  - 有効にすると、AWS マネジメントコンソールへのアクセスが可能なユーザーが作成できる
  - ユーザーが AWS 管理画面を操作する場合に必要である。
  - 今回は IAM ユーザーを作成して作業するためチェックを入れておく必要がある。
- ユーザタイプ : IAM ユーサーを作成します。
- コンソールパスワード : カスタムパスワード

#### 2. 許可を設定

- 許可のオプション
  - ポリシーを直接アタッチする : 新しい IAM ユーザー専用に権限を割り当てるため。グループは今回不要。
- 必要なポリシーを検索して追加
  - AmazonSQSFullAccess : キューの作成、メッセージの送受信、削除など SQS 関連のフル権限を付与するため
  - AWSLambdaBasicExecutionRole : Lamdba 関数の基本的な実行権限を提供する。ログ出力などに必要。
  - AmazonS3ReadOnlyAccess : ファイルの読み取り専用アクセスを付与するため

### 2.Amazon SQS キューの作成

フルマネージドのキューイングサービス。
キューイングとは異なるソフトウェア間でデータの送受信するの一つで、ソフトウェア間で直接データを渡すのではなく、
第三者経由でデータを渡すことで、送信側と受信側が好きなタイミングで処理を行うことができる。

#### 今回の役割

- Slack ではイベントを送信後、3 秒以内にレスポンスを受け取らないとリトライを行う。
- これを防ぐために、SQS にイベント情報を格納し、即時レスポンスを返す。
- SQS に格納されたイベントを順次 Lambda が処理する

#### 1. 詳細

- タイプ : 標準
  - メッセージの順序保証や重複回避が不要で、標準キューの方が処理速度が速いため。
  - 今回は重複処理対策をアプリ側または、Lambda 側で行うため標準キューで問題ないはず。

#### 2. 設定

- 可視化タイムアウト: デフォルトの 30 秒
- メッセージ保持期間: 4 日(デフォルト)

#### 3. 暗号化

- サーバー側の暗号化: 有効
- Encryption key type: AmazonSQS キー
  - AWS が自動的に管理するキーを使用する場合はこのままで OK

#### 4. アクセスポリシー

- メソッドを選択: JSON のボックスが編集可能になる。

### 3. Lambda 関数の作成

Lambda では SQS キューからメッセージを取り出して処理を行う。
Lambda を作成し、SQS キューと連携する設定を行う。

#### オプション選択

- 一から作成を選択

#### 基本的な情報

- ランタイム: Python3.12
- アーキテクチャ: x86_64(標準構成)

#### アクセス権限

- 実行ロール: 基本的な Lambda 権限でアクセス権限で新しいロールを作成

#### Additional Configurations

チェックを入れない

### 4. トリガーの設定

- トリガーを追加を押下する
- SQS を選択する

#### SQS キュー

作成した SQS の ARN を指定する。

#### イベントソースマッピングの設定

- トリガーをすぐに有効にするかどうかを指定する
- 有効にすると、SQS キューからのイベントが即座に Lambda 関数に流れる。
- 今回はチェックを入れる。

#### メトリクスを有効化

- トリガーが CloudWatch のメトリクスに反映されるようにする設定
- メトリクスには、Lambda 関数の呼び出しやエラー数、処理時間などの情報が含まれる
- 今回はチェック入れる。

#### バッチサイズ

- メッセージを修正する時間を設定する
- 0 に設定すると、メッセージを収集せず即座に処理する
- 今回は 0 に設定

#### 最大同時実行数

- Lambda が並列で実行できる最大数を設定する
- 今回はデフォルトのまま(無制限)
